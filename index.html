<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="node_modules/normalize.css/normalize.css">
    <link rel="stylesheet" href="node_modules/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="src/style.css">
    <title id="app-title"></title>
  </head>
  <body>
    <div class="container">
      <div v-if="errorMessage !== ''" class="error-message">
        <a href="#" id="close-error" title="Close message" @click.prevent="updateErrorMessage('')">
          <i class="fa fa-times"></i>
        </a>
        <div class="message" v-html="errorMessage"></div>
      </div>

      <!-- start upload -->
      <form class="drop-box" :class="{ hovered: hovering }" v-if="page <= 2">
        <div class="drop-zone">
          <div class="drop-info">
            <label>Drop a csv here or click to start</label>
            <div class="help" v-text="message"></div>
          </div>
          <input type="file" class="file" multiple="false" accept=".csv" @change="getInputFile">
        </div>
        <button class="next" 
                :class="{ active: csvName }" 
                v-if="page === 2 && csvName"
                @click.prevent="preview"><i class="fa fa-hand-o-right fa-3x button-hover"></i></button>
      </form>
      <!-- end upload -->

      <!-- start preview data -->
      <div class="preview-page" v-if="page === 3">
        <template v-if="csvCache">
          <div class="chosen-file">
            Do you want to use "<strong>{{csvName}}</strong>"?
            <div>Review the blue info bar below for file information</div>
          </div>
          <div>
            <a href="#" @click.prevent="reset">
              <i class="fa fa-thumbs-o-down fa-3x button-hover"></i>
            </a>
            <a href="#" @click.prevent="importFile">
              <i class="fa fa-thumbs-o-up fa-3x button-hover"></i>
            </a>
          </div>
        </template>
        <template v-else>
          <i class="fa fa-refresh fa-spin fa-5x fa-fw"></i>
        </template>
      </div>
      <!-- end preview data -->

      <!-- start import data -->
      <div class="import-page" v-if="page === 4">
        <template v-if="importCount === csvFileCount">
          <div class="scrollbar" id="scroll1">
            <div class="list">
              <!-- ====================== -->
              <div :class="{ 'row': true, 'processed': doc.zzz_processedStatus }" v-for="(doc, indx) in data">
                <ul>
                  <li class="header">
                    <div v-html="doc.zzz_icon"></div>
                    <div>
                      [{{Number.parseInt(doc.zzz_id, 10) + 1}}] {{ doc.Title || 'Document ' + indx }} 
                    </div>
                    <div v-if="doc.zzz_extension === 'pdf'" v-html="doc.zzz_fileLink"></div>
                    <div v-else>
                      <a href="#" target="_blank" @click.prevent="openWithShell(doc.zzz_fullPath)">{{doc.zzz_path}}</a>
                    </div>
                    <a href="#" class="toggle-details" @click.prevent="toggleDetails(indx)"
                    @click.ctrl.prevent="toggleAllDetails">
                      <i class="fa fa-2x" :class="{ 'fa-toggle-off': !doc.zzz_showDetails, 'fa-toggle-on': doc.zzz_showDetails }"></i>
                    </a>
                    <div class="details" v-if="doc.zzz_showDetails">
                      <!-- move this to a function fot tag: splitting -->
                      <div v-for="(key, indx) in Object.keys(doc)" v-if="!key.startsWith('zzz_')">
                        <strong>{{ key }}</span>:</strong>
                        <div class="sub-row">
                          <div class="left-half">{{ doc[key] }}</div>
                          <div class="right-half"><del>{{ doc['zzz_original'][key] }}<del></div>
                        </div>
                      </div>
                    </div>
                  </li>
                </ul>
              </div>
            </div>
          </div>
          <div class="list-menu">
            <div>
              Would you like to update {{ csvFileCount > 1 ? 'these' : 'this' }} 
              <strong v-if="csvFileCount > 1">{{csvFileCount}}</strong> 
              {{ csvFileCount > 1 ? 'files' : 'file' }}?
            </div>
            <a href="#" @click.prevent="reset">
              <i class="fa fa-thumbs-o-down fa-3x button-hover"></i>
            </a>
            <a href="#" @click.prevent="reset">
              <i class="fa fa-thumbs-o-up fa-3x button-hover"></i>
            </a>
          </div>
        </template>
        <template v-else>
          <div class="center-center">
            <i class="fa fa-refresh fa-spin fa-5x fa-fw"></i>
          </div>
        </template>
      </div>
      <!-- end import data -->
 
      <!-- start info bar -->
      <div id="info" class="info">
        <i class="fa fa-info-circle"></i>
        <ul class="content">
          <li v-for="item in info">
            <span>{{item.name}}</span>: {{item.value}}
          </li>
        </ul>
      </div>
      <!-- end info bar -->
    </div>
  </body>

  <script>
    require('./src/script');
  </script>
</html>
